name: NBA Daily Ingestion

on:
  schedule:
    # 07:00 UTC (8:00 AM en España invierno, 9:00 AM verano)
    - cron: '0 7 * * *'
  workflow_dispatch:
    # Permite ejecución manual desde la pestaña Actions de GitHub

jobs:
  trigger_ingest:
    runs-on: ubuntu-latest
    
    steps:
      - name: Trigger Daily Ingestion
        run: |
          if [ -z "${{ secrets.API_BASE_URL }}" ]; then
            echo "Error: API_BASE_URL secret is not set"
            exit 1
          fi
          if [ -z "${{ secrets.SECURE_TOKEN }}" ]; then
            echo "Error: SECURE_TOKEN secret is not set"
            exit 1
          fi
          
          echo "Disparando ingesta diaria en Render..."
          
          # Hacemos la petición POST al nuevo endpoint
          curl -f -X POST "${{ secrets.API_BASE_URL }}/admin/ingest/cron" \
               -H "X-Secure-Token: ${{ secrets.SECURE_TOKEN }}" \
               -H "Content-Length: 0"
          
          echo "Petición enviada con éxito."
