name: NBA System Reset

on:
  workflow_dispatch:
    # Permite ejecución manual desde la pestaña Actions de GitHub para emergencias

jobs:
  reset_system:
    runs-on: ubuntu-latest
    
    steps:
      - name: Trigger System Reset
        run: |
          if [ -z "${{ secrets.API_BASE_URL }}" ]; then
            echo "Error: API_BASE_URL secret is not set"
            exit 1
          fi
          if [ -z "${{ secrets.SECURE_TOKEN }}" ]; then
            echo "Error: SECURE_TOKEN secret is not set"
            exit 1
          fi
          
          echo "Enviando comando de RESET al servidor Render..."
          
          # Hacemos la petición POST al endpoint de reset
          curl -f -X POST "${{ secrets.API_BASE_URL }}/admin/ingest/reset" \
               -H "X-Secure-Token: ${{ secrets.SECURE_TOKEN }}" \
               -H "Content-Length: 0"
          
          echo "Sistema reseteado con éxito. Los procesos han sido terminados y el estado de la BD limpiado."
