{% extends "base.html" %}
{% from "components/nba_components.html" import stats_table_header, summary_row, card_container %}

{% block title %}Box Score - Dateados{% endblock %}

{% block content %}
<div class="space-y-8">
    
    <!-- Scoreboard -->
    <div class="nba-card relative overflow-hidden bg-white dark:bg-zinc-900 border-slate-200 dark:border-white/5 rounded-3xl shadow-xl dark:shadow-2xl transition-colors duration-300">
        <!-- Background Pattern -->
        <div class="absolute inset-0">
            <div class="absolute inset-0 bg-gradient-to-l from-orange-500/10 dark:from-orange-900/20 to-transparent opacity-50"></div>
            <div class="absolute inset-0 bg-grid-slate-900/[0.02] dark:bg-grid-white/[0.02] bg-[length:30px_30px]"></div>
        </div>

        <div class="relative z-10 px-4 md:px-6 lg:px-12 py-8 md:py-12">
            <div class="flex flex-col md:flex-row items-center justify-center gap-6 md:gap-4 lg:gap-12 max-w-6xl mx-auto">
                
                <!-- Away Team -->
                <div class="flex flex-row md:flex-col items-center justify-end md:justify-center gap-4 flex-1 w-full order-2 md:order-1">
                    <div class="text-right md:text-center order-1 md:order-2">
                        <h2 class="text-xl md:text-2xl lg:text-4xl font-display font-black text-slate-900 dark:text-white tracking-tight leading-tight">
                            <span class="md:hidden lg:inline">{{ game.away_team }}</span>
                            <span class="hidden md:inline lg:hidden">{{ game.away_team_abbr }}</span>
                        </h2>
                        <p class="text-[10px] text-zinc-500 dark:text-zinc-400 font-mono uppercase tracking-widest mt-1">Visitante</p>
                    </div>
                    <div class="relative group order-2 md:order-1">
                        <div class="absolute inset-0 bg-slate-200 dark:bg-white/10 rounded-full blur-xl opacity-0 group-hover:opacity-100 transition-all duration-500"></div>
                        <img src="https://cdn.nba.com/logos/nba/{{ game.away_team_id }}/primary/L/logo.svg" 
                             alt="{{ game.away_team }}" 
                             onerror="this.onerror=null; this.src='https://via.placeholder.com/100?text={{ game.away_team_abbr }}'"
                             class="h-16 w-16 sm:h-20 sm:w-20 md:h-28 md:w-28 lg:h-40 lg:w-40 object-contain relative z-10 drop-shadow-2xl transform group-hover:scale-110 transition-transform duration-500">
                    </div>
                </div>
                
                <!-- Game Info & Score -->
                <div class="flex flex-col items-center shrink-0 order-1 md:order-2 px-4 md:px-8 border-b md:border-b-0 border-slate-100 dark:border-white/5 pb-6 md:pb-0 w-full md:w-auto">
                    <div class="flex flex-col items-center gap-2 mb-4">
                        <span class="px-3 py-1 bg-slate-100 dark:bg-white/5 rounded-full text-[10px] font-mono font-bold text-zinc-500 dark:text-zinc-400 border border-slate-200 dark:border-white/5">{{ game.date }}</span>
                        {% if game.status == 2 %}
                            <span class="px-3 py-1 bg-red-500 text-white rounded-full text-[10px] font-black animate-pulse uppercase tracking-wider">VIVO</span>
                        {% else %}
                            <span class="px-3 py-1 bg-slate-200 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 rounded-full text-[10px] font-black uppercase tracking-wider">FINAL</span>
                        {% endif %}
                    </div>
                    
                    <div class="flex items-center gap-4 lg:gap-8">
                        <div class="text-5xl lg:text-8xl font-display font-black text-slate-900 dark:text-white tabular-nums tracking-tighter">{{ game.away_score }}</div>
                        <div class="text-2xl lg:text-4xl text-zinc-300 dark:text-zinc-700 font-black">-</div>
                        <div class="text-5xl lg:text-8xl font-display font-black text-slate-900 dark:text-white tabular-nums tracking-tighter">{{ game.home_score }}</div>
                    </div>
                </div>
                
                <!-- Home Team -->
                <div class="flex flex-row md:flex-col items-center justify-start md:justify-center gap-4 flex-1 w-full order-3">
                    <div class="relative group">
                        <div class="absolute inset-0 bg-slate-200 dark:bg-white/10 rounded-full blur-xl opacity-0 group-hover:opacity-100 transition-all duration-500"></div>
                        <img src="https://cdn.nba.com/logos/nba/{{ game.home_team_id }}/primary/L/logo.svg" 
                             alt="{{ game.home_team }}" 
                             onerror="this.onerror=null; this.src='https://via.placeholder.com/100?text={{ game.home_team_abbr }}'"
                             class="h-16 w-16 sm:h-20 sm:w-20 md:h-28 md:w-28 lg:h-40 lg:w-40 object-contain relative z-10 drop-shadow-2xl transform group-hover:scale-110 transition-transform duration-500">
                    </div>
                    <div class="text-left md:text-center">
                        <h2 class="text-xl md:text-2xl lg:text-4xl font-display font-black text-slate-900 dark:text-white tracking-tight leading-tight">
                            <span class="md:hidden lg:inline">{{ game.home_team }}</span>
                            <span class="hidden md:inline lg:hidden">{{ game.home_team_abbr }}</span>
                        </h2>
                        <p class="text-[10px] text-zinc-500 dark:text-zinc-400 font-mono uppercase tracking-widest mt-1">Local</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quarter Scores Strip -->
        {% if game.quarter_scores and game.quarter_scores.away and game.quarter_scores.home and game.quarter_scores.away|length > 0 %}
        <div class="nba-surface-accent py-4 overflow-x-auto overflow-y-hidden custom-scrollbar">
            <div class="flex justify-center min-w-max px-6">
                <table class="text-sm md:text-base border-separate border-spacing-x-8">
                    <thead>
                        <tr>
                            <th class="text-left text-zinc-400 dark:text-zinc-500 font-bold uppercase text-[10px] tracking-widest">Equipo</th>
                            {% for i in range(game.quarter_scores.away|length) %}
                            <th class="text-center text-zinc-400 dark:text-zinc-500 font-bold uppercase text-[10px] tracking-widest w-12">
                                {% if i < 4 %}Q{{ i+1 }}{% else %}OT{{ i-3 }}{% endif %}
                            </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody class="font-mono">
                        <tr>
                            <td class="font-bold text-slate-900 dark:text-white py-2">{{ game.away_team }}</td>
                            {% for score in game.quarter_scores.away %}
                            <td class="text-center text-slate-600 dark:text-zinc-300">{{ score }}</td>
                            {% endfor %}
                        </tr>
                        <tr>
                            <td class="font-bold text-slate-900 dark:text-white py-2">{{ game.home_team }}</td>
                            {% for score in game.quarter_scores.home %}
                            <td class="text-center text-slate-600 dark:text-zinc-300">{{ score }}</td>
                            {% endfor %}
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}
    </div>

    {% macro render_stats_table(stats, totals) %}
    <div class="table-container">
        <table class="min-w-full text-[10px] md:text-xs">
            {{ stats_table_header([
                {'label': 'Jugador', 'class': 'text-left'},
                {'label': 'MIN'},
                {'label': 'PTS', 'highlight': True},
                {'label': 'REB'},
                {'label': 'AST'},
                {'label': 'STL'},
                {'label': 'BLK'},
                {'label': 'TOV'},
                {'label': 'PF'},
                {'label': 'FG'},
                {'label': '3PT'},
                {'label': 'FT'},
                {'label': '+/-'}
            ]) }}
            <tbody class="divide-y divide-slate-100 dark:divide-white/5">
                {% for stat in stats %}
                <tr class="hover:bg-slate-50 dark:hover:bg-white/5 transition group">
                    <td class="px-3 md:px-4 py-3 sticky-column bg-inherit whitespace-nowrap">
                        <a href="/players/{{ stat.player_id }}" class="font-bold text-zinc-700 dark:text-zinc-200 group-hover:text-orange-500 transition-colors">
                            {{ stat.player }}
                        </a>
                    </td>
                    <td class="px-2 py-3 text-center font-mono text-zinc-500 dark:text-zinc-400">
                        {{ stat.min or '-' }}
                    </td>
                    <td class="px-2 py-3 text-center font-mono font-bold text-slate-900 dark:text-white bg-slate-50/50 dark:bg-white/5">{{ stat.pts }}</td>
                    <td class="px-2 py-3 text-center font-mono text-slate-900 dark:text-zinc-300">{{ stat.reb }}</td>
                    <td class="px-2 py-3 text-center font-mono text-slate-900 dark:text-zinc-300">{{ stat.ast }}</td>
                    <td class="px-2 py-3 text-center font-mono text-zinc-500 dark:text-zinc-400">{{ stat.stl }}</td>
                    <td class="px-2 py-3 text-center font-mono text-zinc-500 dark:text-zinc-400">{{ stat.blk }}</td>
                    <td class="px-2 py-3 text-center font-mono text-zinc-500 dark:text-zinc-400">{{ stat.tov }}</td>
                    <td class="px-2 py-3 text-center font-mono text-zinc-500 dark:text-zinc-400">{{ stat.pf }}</td>
                    <td class="px-2 py-3 text-center font-mono text-zinc-500 dark:text-zinc-400">{{ stat.fgm }}/{{ stat.fga }}</td>
                    <td class="px-2 py-3 text-center font-mono text-zinc-500 dark:text-zinc-400">{{ stat.fg3m }}/{{ stat.fg3a }}</td>
                    <td class="px-2 py-3 text-center font-mono text-zinc-500 dark:text-zinc-400">{{ stat.ftm }}/{{ stat.fta }}</td>
                    <td class="px-2 py-3 text-center font-mono font-bold {% if stat.plus_minus > 0 %}text-green-600 dark:text-green-400{% elif stat.plus_minus < 0 %}text-red-500 dark:text-red-400{% else %}text-zinc-500{% endif %}">
                        {{ "%+d"|format(stat.plus_minus|int) if stat.plus_minus is not none else "-" }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            {% if totals %}
            <tfoot class="border-t-2 border-slate-200 dark:border-white/10">
                {{ summary_row('TOTALES', [
                    {'value': totals.total_pts, 'highlight': True},
                    {'value': totals.total_reb},
                    {'value': totals.total_ast},
                    {'value': totals.total_stl},
                    {'value': totals.total_blk},
                    {'value': totals.total_tov},
                    {'value': totals.total_pf},
                    {'value': totals.total_fgm ~ '/' ~ totals.total_fga},
                    {'value': totals.total_fg3m ~ '/' ~ totals.total_fg3a},
                    {'value': totals.total_ftm ~ '/' ~ totals.total_fta},
                    {'value': '-'}
                ], colspan=2) }}
            </tfoot>
            {% endif %}
        </table>
    </div>
    {% endmacro %}

    <!-- Away Team Stats -->
    {% call card_container(title=game.away_team ~ " - Estadísticas", icon_url="https://cdn.nba.com/logos/nba/" ~ game.away_team_id ~ "/primary/L/logo.svg") %}
        {{ render_stats_table(away_stats, away_totals) }}
    {% endcall %}

    <!-- Home Team Stats -->
    {% call card_container(title=game.home_team ~ " - Estadísticas", icon_url="https://cdn.nba.com/logos/nba/" ~ game.home_team_id ~ "/primary/L/logo.svg") %}
        {{ render_stats_table(home_stats, home_totals) }}
    {% endcall %}
</div>
{% endblock %}
