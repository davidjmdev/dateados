{% extends "base.html" %}
{% from "components/nba_components.html" import stats_table_header, card_container, bracket_series_card, page_header, pill_tabs_js %}

{% block title %}Temporada {{ season }} - Dateados{% endblock %}

{% block content %}
<div class="space-y-8">
    {% call page_header("Temporada " ~ season, "Resultados, clasificaciones y estadisticas del ano.") %}
        <div class="nba-filter-box">
            <span class="text-[10px] font-black text-slate-500 dark:text-zinc-400 uppercase tracking-widest">Cambiar Temporada:</span>
            <select onchange="window.location.href='/seasons/' + this.value" class="nba-select">
                {% for s in all_seasons %}
                <option value="{{ s }}" {% if s == season %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
            </select>
        </div>
    {% endcall %}

    {% set tabs = [{'id': 'regular', 'label': 'Regular'}] %}
    {% if bracket %}
        {% set tabs = tabs + [{'id': 'playoffs', 'label': 'Playoffs'}] %}
    {% endif %}
    {% if ist_bracket %}
        {% set tabs = tabs + [{'id': 'ist', 'label': 'NBA Cup'}] %}
    {% endif %}
    
    {{ pill_tabs_js(tabs, active_id='regular', js_function="nbaSwitchTab.bind(null, 'content')", id_prefix='tab') }}

    <!-- Regular Season Standings -->
    <div id="content-regular" class="space-y-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
            <!-- Eastern Conference -->
            {% call card_container(title="Conferencia Este", class="border-zinc-200 dark:border-white/10") %}
                <div class="table-container">
                    <table class="min-w-full text-xs md:text-sm">
                        {{ stats_table_header([
                            {'label': '#', 'class': 'text-left w-10'},
                            {'label': 'Equipo', 'class': 'text-left'},
                            {'label': 'W', 'highlight': True},
                            {'label': 'L'},
                            {'label': 'PCT'}
                        ]) }}
                        <tbody class="divide-y divide-slate-100 dark:divide-white/5">
                            {% for entry in east_standings %}
                            <tr class="hover:bg-slate-50 dark:hover:bg-white/5 transition cursor-pointer group" onclick="window.location='/teams/{{ entry.team.id }}?season={{ season }}'">
                                <td class="px-3 md:px-6 py-3 md:py-4 text-slate-500 dark:text-zinc-500 font-mono sticky-column bg-inherit">{{ loop.index }}</td>
                                <td class="px-3 md:px-6 py-3 md:py-4 font-bold text-slate-900 dark:text-white whitespace-nowrap group-hover:text-orange-500 transition-colors">
                                    <div class="flex items-center">
                                        <img src="https://cdn.nba.com/logos/nba/{{ entry.team.id }}/primary/L/logo.svg" 
                                             alt="" 
                                             onerror="this.style.display='none'"
                                             class="h-5 w-5 md:h-6 md:w-6 object-contain mr-2 md:mr-3">
                                        <span class="hidden md:inline">{{ entry.team.full_name }}</span>
                                        <span class="md:hidden">{{ entry.team.abbreviation }}</span>
                                    </div>
                                </td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-slate-900 dark:text-white font-bold bg-orange-500/5 dark:bg-orange-500/10">{{ entry.wins }}</td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-slate-500 dark:text-zinc-400">{{ entry.losses }}</td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-slate-900 dark:text-white font-mono">{{ "%.3f"|format(entry.pct) }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="px-6 py-12 text-center text-slate-500 dark:text-zinc-400 font-medium italic">No hay datos disponibles.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endcall %}

            <!-- Western Conference -->
            {% call card_container(title="Conferencia Oeste", class="border-zinc-200 dark:border-white/10") %}
                <div class="table-container">
                    <table class="min-w-full text-xs md:text-sm">
                        {{ stats_table_header([
                            {'label': '#', 'class': 'text-left w-10'},
                            {'label': 'Equipo', 'class': 'text-left'},
                            {'label': 'W', 'highlight': True},
                            {'label': 'L'},
                            {'label': 'PCT'}
                        ]) }}
                        <tbody class="divide-y divide-slate-100 dark:divide-white/5">
                            {% for entry in west_standings %}
                            <tr class="hover:bg-slate-50 dark:hover:bg-white/5 transition cursor-pointer group" onclick="window.location='/teams/{{ entry.team.id }}?season={{ season }}'">
                                <td class="px-3 md:px-6 py-3 md:py-4 text-slate-500 dark:text-zinc-500 font-mono sticky-column bg-inherit">{{ loop.index }}</td>
                                <td class="px-3 md:px-6 py-3 md:py-4 font-bold text-slate-900 dark:text-white whitespace-nowrap group-hover:text-orange-500 transition-colors">
                                    <div class="flex items-center">
                                        <img src="https://cdn.nba.com/logos/nba/{{ entry.team.id }}/primary/L/logo.svg" 
                                             alt="" 
                                             onerror="this.style.display='none'"
                                             class="h-5 w-5 md:h-6 md:w-6 object-contain mr-2 md:mr-3">
                                        <span class="hidden md:inline">{{ entry.team.full_name }}</span>
                                        <span class="md:hidden">{{ entry.team.abbreviation }}</span>
                                    </div>
                                </td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-slate-900 dark:text-white font-bold bg-orange-500/5 dark:bg-orange-500/10">{{ entry.wins }}</td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-slate-500 dark:text-zinc-400">{{ entry.losses }}</td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-slate-900 dark:text-white font-mono">{{ "%.3f"|format(entry.pct) }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="px-6 py-12 text-center text-slate-500 dark:text-zinc-400 font-medium italic">No hay datos disponibles.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endcall %}
        </div>
    </div>

    <!-- Playoff Bracket Section -->
    {% if bracket %}
    <div id="content-playoffs" class="hidden">
        <div class="overflow-x-auto pb-12 pt-4">
            <div class="inline-flex min-w-full px-4 items-stretch">
                {% for round in bracket %}
                <div class="flex-shrink-0 w-64 flex flex-col mx-4">
                    <h3 class="text-center font-black text-slate-900 dark:text-white bg-slate-50/50 dark:bg-black/20 border border-slate-100 dark:border-white/5 py-3 rounded-xl mb-4 shadow-sm uppercase tracking-widest text-xs font-display">{{ round.name }}</h3>
                    
                    <div class="flex flex-col justify-around flex-grow">
                        {% for series in round.series %}
                            {{ bracket_series_card(series, season, is_ist=False) }}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- IST Bracket Section -->
    {% if ist_bracket %}
    <div id="content-ist" class="hidden">
        <div class="overflow-x-auto pb-12 pt-4">
            <div class="inline-flex min-w-full px-4 items-stretch">
                {% for round in ist_bracket %}
                <div class="flex-shrink-0 w-64 flex flex-col mx-4">
                    <h3 class="text-center font-black text-slate-900 dark:text-white bg-slate-50/50 dark:bg-black/20 border border-slate-100 dark:border-white/5 py-3 rounded-xl mb-4 shadow-sm uppercase tracking-widest text-xs font-display">{{ round.name }}</h3>
                    
                    <div class="flex flex-col justify-around flex-grow">
                        {% for series in round.series %}
                            {{ bracket_series_card(series, season, is_ist=True) }}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
