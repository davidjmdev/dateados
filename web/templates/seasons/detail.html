{% extends "base.html" %}
{% from "components/nba_components.html" import stats_table_header, card_container, bracket_series_card %}

{% block title %}Temporada {{ season }} - Dateados{% endblock %}

{% block content %}
<div class="space-y-8">
    <div class="relative overflow-hidden rounded-3xl bg-white dark:bg-zinc-900 border border-slate-200 dark:border-white/5 p-8 md:p-12 shadow-xl dark:shadow-2xl transition-colors duration-300">
        <div class="absolute inset-0 bg-gradient-to-l from-orange-500/10 dark:from-orange-900/20 to-transparent opacity-50"></div>
        <div class="absolute inset-0 bg-grid-slate-900/[0.02] dark:bg-grid-white/[0.02] bg-[length:30px_30px]"></div>
        
        <div class="relative z-10 flex flex-col lg:flex-row lg:items-center justify-between gap-8">
            <div>
                <h1 class="text-4xl md:text-5xl font-display font-black text-slate-900 dark:text-white tracking-tighter mb-2">Temporada {{ season }}</h1>
                <p class="text-slate-600 dark:text-zinc-400 max-w-2xl text-lg font-medium">Resultados, clasificaciones y estadísticas del año.</p>
            </div>
            
            <div class="flex items-center space-x-4 bg-slate-50 dark:bg-white/5 p-4 rounded-2xl border border-slate-200 dark:border-white/5 backdrop-blur-sm">
                <span class="text-[10px] font-black text-slate-500 dark:text-zinc-400 uppercase tracking-widest">Cambiar Temporada:</span>
                <select onchange="window.location.href='/seasons/' + this.value" class="bg-white dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 text-slate-900 dark:text-gray-100 text-sm rounded-xl focus:ring-2 focus:ring-orange-500 outline-none p-2 shadow-sm font-bold">
                    {% for s in all_seasons %}
                    <option value="{{ s }}" {% if s == season %}selected{% endif %}>{{ s }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="overflow-x-auto overflow-y-hidden custom-scrollbar bg-white/50 dark:bg-white/5 backdrop-blur-sm rounded-full p-1 mb-6 border border-slate-200 dark:border-white/5">
        <nav class="flex w-full space-x-1" aria-label="Tabs">
            <button onclick="switchTab('regular')" id="tab-regular" class="flex-auto px-6 py-2 rounded-full text-xs font-black whitespace-nowrap transition-all bg-orange-500 text-white shadow-lg shadow-orange-500/20 uppercase tracking-widest">
                Regular
            </button>
            {% if bracket %}
            <button onclick="switchTab('playoffs')" id="tab-playoffs" class="flex-auto px-6 py-2 rounded-full text-xs font-black whitespace-nowrap transition-all text-slate-500 hover:text-slate-900 dark:text-zinc-400 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-white/5 uppercase tracking-widest">
                Playoffs
            </button>
            {% endif %}
            {% if ist_bracket %}
            <button onclick="switchTab('ist')" id="tab-ist" class="flex-auto px-6 py-2 rounded-full text-xs font-black whitespace-nowrap transition-all text-slate-500 hover:text-slate-900 dark:text-zinc-400 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-white/5 uppercase tracking-widest">
                NBA Cup
            </button>
            {% endif %}
        </nav>
    </div>

    <!-- Regular Season Standings -->
    <div id="content-regular" class="space-y-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
            <!-- Eastern Conference -->
            {% call card_container(title="Conferencia Este", class="border-zinc-200 dark:border-white/10") %}
                <div class="table-container">
                    <table class="min-w-full text-xs md:text-sm">
                        {{ stats_table_header([
                            {'label': '#', 'class': 'text-left w-10'},
                            {'label': 'Equipo', 'class': 'text-left'},
                            {'label': 'W', 'highlight': True},
                            {'label': 'L'},
                            {'label': 'PCT'}
                        ]) }}
                        <tbody class="divide-y divide-slate-100 dark:divide-white/5">
                            {% for entry in east_standings %}
                            <tr class="hover:bg-slate-50 dark:hover:bg-white/5 transition cursor-pointer group" onclick="window.location='/teams/{{ entry.team.id }}?season={{ season }}'">
                                <td class="px-3 md:px-6 py-3 md:py-4 text-slate-500 dark:text-zinc-500 font-mono sticky-column bg-inherit">{{ loop.index }}</td>
                                <td class="px-3 md:px-6 py-3 md:py-4 font-bold text-slate-900 dark:text-white whitespace-nowrap group-hover:text-orange-500 transition-colors">
                                    <div class="flex items-center">
                                        <img src="https://cdn.nba.com/logos/nba/{{ entry.team.id }}/primary/L/logo.svg" 
                                             alt="" 
                                             onerror="this.style.display='none'"
                                             class="h-5 w-5 md:h-6 md:w-6 object-contain mr-2 md:mr-3">
                                        <span class="hidden md:inline">{{ entry.team.full_name }}</span>
                                        <span class="md:hidden">{{ entry.team.abbreviation }}</span>
                                    </div>
                                </td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-slate-900 dark:text-white font-bold bg-orange-500/5 dark:bg-orange-500/10">{{ entry.wins }}</td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-slate-500 dark:text-zinc-400">{{ entry.losses }}</td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-slate-900 dark:text-white font-mono">{{ "%.3f"|format(entry.pct) }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="px-6 py-12 text-center text-slate-500 dark:text-zinc-400 font-medium italic">No hay datos disponibles.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endcall %}

            <!-- Western Conference -->
            {% call card_container(title="Conferencia Oeste", class="border-zinc-200 dark:border-white/10") %}
                <div class="table-container">
                    <table class="min-w-full text-xs md:text-sm">
                        {{ stats_table_header([
                            {'label': '#', 'class': 'text-left w-10'},
                            {'label': 'Equipo', 'class': 'text-left'},
                            {'label': 'W', 'highlight': True},
                            {'label': 'L'},
                            {'label': 'PCT'}
                        ]) }}
                        <tbody class="divide-y divide-slate-100 dark:divide-white/5">
                            {% for entry in west_standings %}
                            <tr class="hover:bg-slate-50 dark:hover:bg-white/5 transition cursor-pointer group" onclick="window.location='/teams/{{ entry.team.id }}?season={{ season }}'">
                                <td class="px-3 md:px-6 py-3 md:py-4 text-slate-500 dark:text-zinc-500 font-mono sticky-column bg-inherit">{{ loop.index }}</td>
                                <td class="px-3 md:px-6 py-3 md:py-4 font-bold text-slate-900 dark:text-white whitespace-nowrap group-hover:text-orange-500 transition-colors">
                                    <div class="flex items-center">
                                        <img src="https://cdn.nba.com/logos/nba/{{ entry.team.id }}/primary/L/logo.svg" 
                                             alt="" 
                                             onerror="this.style.display='none'"
                                             class="h-5 w-5 md:h-6 md:w-6 object-contain mr-2 md:mr-3">
                                        <span class="hidden md:inline">{{ entry.team.full_name }}</span>
                                        <span class="md:hidden">{{ entry.team.abbreviation }}</span>
                                    </div>
                                </td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-slate-900 dark:text-white font-bold bg-orange-500/5 dark:bg-orange-500/10">{{ entry.wins }}</td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-slate-500 dark:text-zinc-400">{{ entry.losses }}</td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-slate-900 dark:text-white font-mono">{{ "%.3f"|format(entry.pct) }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="px-6 py-12 text-center text-slate-500 dark:text-zinc-400 font-medium italic">No hay datos disponibles.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endcall %}
        </div>
    </div>

    <!-- Playoff Bracket Section -->
    {% if bracket %}
    <div id="content-playoffs" class="hidden">
        <div class="overflow-x-auto pb-12 pt-4">
            <div class="inline-flex min-w-full px-4 items-stretch">
                {% for round in bracket %}
                <div class="flex-shrink-0 w-64 flex flex-col mx-4">
                    <h3 class="text-center font-black text-slate-900 dark:text-white bg-slate-50/50 dark:bg-black/20 border border-slate-100 dark:border-white/5 py-3 rounded-xl mb-4 shadow-sm uppercase tracking-widest text-xs font-display">{{ round.name }}</h3>
                    
                    <div class="flex flex-col justify-around flex-grow">
                        {% for series in round.series %}
                            {{ bracket_series_card(series, season, is_ist=False) }}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- IST Bracket Section -->
    {% if ist_bracket %}
    <div id="content-ist" class="hidden">
        <div class="overflow-x-auto pb-12 pt-4">
            <div class="inline-flex min-w-full px-4 items-stretch">
                {% for round in ist_bracket %}
                <div class="flex-shrink-0 w-64 flex flex-col mx-4">
                    <h3 class="text-center font-black text-slate-900 dark:text-white bg-slate-50/50 dark:bg-black/20 border border-slate-100 dark:border-white/5 py-3 rounded-xl mb-4 shadow-sm uppercase tracking-widest text-xs font-display">{{ round.name }}</h3>
                    
                    <div class="flex flex-col justify-around flex-grow">
                        {% for series in round.series %}
                            {{ bracket_series_card(series, season, is_ist=True) }}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    function switchTab(tab) {
        const regTab = document.getElementById('tab-regular');
        const poTab = document.getElementById('tab-playoffs');
        const istTab = document.getElementById('tab-ist');
        
        const regContent = document.getElementById('content-regular');
        const poContent = document.getElementById('content-playoffs');
        const istContent = document.getElementById('content-ist');

        const activeClasses = 'flex-auto px-6 py-2 rounded-full text-xs font-black whitespace-nowrap transition-all bg-orange-500 text-white shadow-lg shadow-orange-500/20 uppercase tracking-widest';
        const inactiveClasses = 'flex-auto px-6 py-2 rounded-full text-xs font-black whitespace-nowrap transition-all text-slate-500 hover:text-slate-900 dark:text-zinc-400 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-white/5 uppercase tracking-widest';

        // Reset all tabs
        if (regTab) regTab.className = inactiveClasses;
        if (poTab) poTab.className = inactiveClasses;
        if (istTab) istTab.className = inactiveClasses;
        
        if (regContent) regContent.classList.add('hidden');
        if (poContent) poContent.classList.add('hidden');
        if (istContent) istContent.classList.add('hidden');

        // Set active tab
        if (tab === 'regular') {
            if (regTab) regTab.className = activeClasses;
            if (regContent) regContent.classList.remove('hidden');
        } else if (tab === 'playoffs') {
            if (poTab) poTab.className = activeClasses;
            if (poContent) poContent.classList.remove('hidden');
        } else if (tab === 'ist') {
            if (istTab) istTab.className = activeClasses;
            if (istContent) istContent.classList.remove('hidden');
        }
    }
</script>
{% endblock %}
