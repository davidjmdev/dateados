{% extends "base.html" %}
{% from "components/nba_components.html" import stats_table_header, card_container, bracket_series_card %}

{% block title %}Temporada {{ season }} - Dateados{% endblock %}

{% block content %}
<div class="space-y-8">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700 p-4 md:p-6 flex flex-col sm:flex-row items-center justify-between gap-4">
        <h1 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">Temporada {{ season }}</h1>
        
        <div class="flex items-center space-x-4">
            <span class="text-xs md:text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider">Temporada:</span>
            <form method="get" class="flex items-center">
                <select onchange="window.location.href='/seasons/' + this.value" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-md focus:ring-blue-500 focus:border-blue-500 block p-1.5 shadow-sm">
                    {% for s in all_seasons %}
                    <option value="{{ s }}" {% if s == season %}selected{% endif %}>{{ s }}</option>
                    {% endfor %}
                </select>
            </form>
        </div>
    </div>

    <!-- Tabs -->
    <div class="border-b border-gray-200 dark:border-gray-700 overflow-x-auto custom-scrollbar">
        <nav class="-mb-px flex space-x-4 md:space-x-8 min-w-max" aria-label="Tabs">
            <button onclick="switchTab('regular')" id="tab-regular" class="border-blue-500 text-blue-600 dark:text-blue-400 whitespace-nowrap py-4 px-1 border-b-2 font-bold text-xs md:text-sm uppercase tracking-widest">
                Regular
            </button>
            {% if bracket %}
            <button onclick="switchTab('playoffs')" id="tab-playoffs" class="border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 whitespace-nowrap py-4 px-1 border-b-2 font-bold text-xs md:text-sm uppercase tracking-widest">
                Playoffs
            </button>
            {% endif %}
            {% if ist_bracket %}
            <button onclick="switchTab('ist')" id="tab-ist" class="border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 whitespace-nowrap py-4 px-1 border-b-2 font-bold text-xs md:text-sm uppercase tracking-widest">
                NBA Cup
            </button>
            {% endif %}
        </nav>
    </div>

    <!-- Regular Season Standings -->
    <div id="content-regular" class="space-y-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
            <!-- Eastern Conference -->
            {% call card_container(title="Conferencia Este", class="border-blue-100 dark:border-blue-900") %}
                <div class="table-container">
                    <table class="min-w-full text-xs md:text-sm">
                        {{ stats_table_header([
                            {'label': '#', 'class': 'text-left w-10'},
                            {'label': 'Equipo', 'class': 'text-left'},
                            {'label': 'W', 'highlight': True},
                            {'label': 'L'},
                            {'label': 'PCT'}
                        ]) }}
                        <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
                            {% for entry in east_standings %}
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition cursor-pointer" onclick="window.location='/teams/{{ entry.team.id }}?season={{ season }}'">
                                <td class="px-3 md:px-6 py-3 md:py-4 text-gray-500 dark:text-gray-400 font-mono sticky-column">{{ loop.index }}</td>
                                <td class="px-3 md:px-6 py-3 md:py-4 font-bold text-gray-900 dark:text-gray-100 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <img src="https://cdn.nba.com/logos/nba/{{ entry.team.id }}/primary/L/logo.svg" 
                                             alt="" 
                                             onerror="this.style.display='none'"
                                             class="h-5 w-5 md:h-6 md:w-6 object-contain mr-2 md:mr-3">
                                        <span class="hidden md:inline">{{ entry.team.full_name }}</span>
                                        <span class="md:hidden">{{ entry.team.abbreviation }}</span>
                                    </div>
                                </td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-gray-900 dark:text-gray-100 font-bold bg-gray-50/50 dark:bg-gray-700/50">{{ entry.wins }}</td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-gray-500 dark:text-gray-400">{{ entry.losses }}</td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-gray-900 dark:text-gray-100 font-mono">{{ "%.3f"|format(entry.pct) }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">No hay datos disponibles.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endcall %}

            <!-- Western Conference -->
            {% call card_container(title="Conferencia Oeste", class="border-red-100 dark:border-red-900") %}
                <div class="table-container">
                    <table class="min-w-full text-xs md:text-sm">
                        {{ stats_table_header([
                            {'label': '#', 'class': 'text-left w-10'},
                            {'label': 'Equipo', 'class': 'text-left'},
                            {'label': 'W', 'highlight': True},
                            {'label': 'L'},
                            {'label': 'PCT'}
                        ]) }}
                        <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
                            {% for entry in west_standings %}
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition cursor-pointer" onclick="window.location='/teams/{{ entry.team.id }}?season={{ season }}'">
                                <td class="px-3 md:px-6 py-3 md:py-4 text-gray-500 dark:text-gray-400 font-mono sticky-column">{{ loop.index }}</td>
                                <td class="px-3 md:px-6 py-3 md:py-4 font-bold text-gray-900 dark:text-gray-100 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <img src="https://cdn.nba.com/logos/nba/{{ entry.team.id }}/primary/L/logo.svg" 
                                             alt="" 
                                             onerror="this.style.display='none'"
                                             class="h-5 w-5 md:h-6 md:w-6 object-contain mr-2 md:mr-3">
                                        <span class="hidden md:inline">{{ entry.team.full_name }}</span>
                                        <span class="md:hidden">{{ entry.team.abbreviation }}</span>
                                    </div>
                                </td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-gray-900 dark:text-gray-100 font-bold bg-gray-50/50 dark:bg-gray-700/50">{{ entry.wins }}</td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-gray-500 dark:text-gray-400">{{ entry.losses }}</td>
                                <td class="px-4 md:px-6 py-3 md:py-4 text-center text-gray-900 dark:text-gray-100 font-mono">{{ "%.3f"|format(entry.pct) }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">No hay datos disponibles.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endcall %}
        </div>
    </div>

    <!-- Playoff Bracket Section -->
    {% if bracket %}
    <div id="content-playoffs" class="hidden">
        <div class="overflow-x-auto pb-12 pt-4">
            <div class="inline-flex min-w-full px-4 items-stretch">
                {% for round in bracket %}
                <div class="flex-shrink-0 w-64 flex flex-col mx-4">
                    <h3 class="text-center font-bold text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 py-3 rounded-lg mb-4 shadow-sm">{{ round.name }}</h3>
                    
                    <div class="flex flex-col justify-around flex-grow">
                        {% for series in round.series %}
                            {{ bracket_series_card(series, season, is_ist=False) }}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- IST Bracket Section -->
    {% if ist_bracket %}
    <div id="content-ist" class="hidden">
        <div class="overflow-x-auto pb-12 pt-4">
            <div class="inline-flex min-w-full px-4 items-stretch">
                {% for round in ist_bracket %}
                <div class="flex-shrink-0 w-64 flex flex-col mx-4">
                    <h3 class="text-center font-bold text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 py-3 rounded-lg mb-4 shadow-sm">{{ round.name }}</h3>
                    
                    <div class="flex flex-col justify-around flex-grow">
                        {% for series in round.series %}
                            {{ bracket_series_card(series, season, is_ist=True) }}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    function switchTab(tab) {
        const regTab = document.getElementById('tab-regular');
        const poTab = document.getElementById('tab-playoffs');
        const istTab = document.getElementById('tab-ist');
        
        const regContent = document.getElementById('content-regular');
        const poContent = document.getElementById('content-playoffs');
        const istContent = document.getElementById('content-ist');

        const activeClasses = 'border-blue-500 text-blue-600 dark:text-blue-400 whitespace-nowrap py-4 px-1 border-b-2 font-bold text-xs md:text-sm uppercase tracking-widest';
        const inactiveClasses = 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 whitespace-nowrap py-4 px-1 border-b-2 font-bold text-xs md:text-sm uppercase tracking-widest';

        // Reset all tabs
        if (regTab) regTab.className = inactiveClasses;
        if (poTab) poTab.className = inactiveClasses;
        if (istTab) istTab.className = inactiveClasses;
        
        if (regContent) regContent.classList.add('hidden');
        if (poContent) poContent.classList.add('hidden');
        if (istContent) istContent.classList.add('hidden');

        // Set active tab
        if (tab === 'regular') {
            if (regTab) regTab.className = activeClasses;
            if (regContent) regContent.classList.remove('hidden');
        } else if (tab === 'playoffs') {
            if (poTab) poTab.className = activeClasses;
            if (poContent) poContent.classList.remove('hidden');
        } else if (tab === 'ist') {
            if (istTab) istTab.className = activeClasses;
            if (istContent) istContent.classList.remove('hidden');
        }
    }
</script>
{% endblock %}
