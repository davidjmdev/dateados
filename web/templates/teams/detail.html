{% extends "base.html" %}
{% from "components/nba_components.html" import stats_table_header, card_container %}

{% block title %}{{ team.full_name }} - Dateados{% endblock %}

{% block content %}
<div class="space-y-8">
    
    <!-- Team Header (Hero) -->
    <div class="nba-card relative overflow-hidden bg-white dark:bg-zinc-900 border-slate-200 dark:border-white/5 transition-colors duration-300">
        <!-- Abstract Background -->
        <div class="absolute inset-0">
            <div class="absolute inset-0 bg-gradient-to-r from-slate-50 dark:from-black via-white/90 dark:via-zinc-900/90 to-transparent z-10"></div>
            <!-- We would ideally use team colors here, using indigo/orange as fallback -->
            <div class="absolute right-0 top-0 w-2/3 h-full bg-gradient-to-l from-orange-500/10 dark:from-orange-900/20 to-transparent"></div>
            <div class="absolute -right-24 -top-24 w-96 h-96 bg-orange-500/5 dark:bg-orange-500/10 rounded-full blur-3xl"></div>
        </div>

        <div class="relative z-20 px-6 py-8 md:p-10">
            <div class="flex flex-col md:flex-row items-center md:items-end gap-8">
                <!-- Logo -->
                <div class="relative group">
                    <div class="absolute inset-0 bg-orange-500/10 dark:bg-white/10 rounded-full blur-2xl group-hover:bg-orange-500/20 dark:group-hover:bg-white/20 transition-all duration-500"></div>
                    <img src="https://cdn.nba.com/logos/nba/{{ team.id }}/primary/L/logo.svg" 
                         alt="{{ team.full_name }}" 
                         onerror="this.onerror=null; this.src='https://via.placeholder.com/150?text={{ team.abbreviation }}'"
                         class="h-32 w-32 md:h-40 md:w-40 object-contain relative z-10 drop-shadow-2xl transform group-hover:scale-105 transition-transform duration-500">
                </div>
                
                <!-- Info -->
                <div class="text-center md:text-left flex-1">
                    <h1 class="text-4xl md:text-6xl font-display font-black text-slate-900 dark:text-white tracking-tighter mb-2">{{ team.full_name }}</h1>
                    <div class="flex flex-wrap justify-center md:justify-start gap-3 text-sm font-mono uppercase tracking-widest text-slate-500 dark:text-zinc-400">
                        <span class="px-2 py-1 bg-slate-100 dark:bg-white/5 rounded border border-slate-200 dark:border-white/5">{{ team.conference }} Conference</span>
                        <span class="px-2 py-1 bg-slate-100 dark:bg-white/5 rounded border border-slate-200 dark:border-white/5">{{ team.division }} Division</span>
                    </div>
                </div>
                
                <!-- Record -->
                <div class="flex flex-col items-center md:items-end bg-slate-100 dark:bg-white/5 p-4 rounded-xl border border-slate-200 dark:border-white/5 backdrop-blur-sm">
                    <div class="text-4xl md:text-5xl font-display font-black text-slate-900 dark:text-white tracking-tighter">{{ record.wins }}-{{ record.losses }}</div>
                    <div class="text-[10px] font-bold text-orange-600 dark:text-orange-500 uppercase tracking-widest mt-1">Record {{ season }}</div>
                </div>
            </div>
        </div>
        
        <!-- Navigation Bar -->
        <div class="relative z-20 px-6 py-3 border-t border-slate-200 dark:border-white/5 bg-slate-50/50 dark:bg-black/20 backdrop-blur-sm flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="flex items-center space-x-4 w-full md:w-auto">
                <span class="text-xs font-bold text-slate-500 dark:text-zinc-400 uppercase tracking-wider">Temporada:</span>
                <form method="get" class="flex-grow md:flex-grow-0">
                    <select name="season" onchange="this.form.submit()" class="w-full md:w-48 bg-white dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 text-slate-900 dark:text-white text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block p-2">
                        {% for s in all_seasons %}
                        <option value="{{ s }}" {% if s == season %}selected{% endif %}>{{ s }}</option>
                        {% endfor %}
                    </select>
                </form>
            </div>
            
            <div class="flex items-center gap-6 text-sm font-mono">
                <div>
                    <span class="text-slate-500 dark:text-zinc-500 uppercase text-[10px] tracking-wider mr-2">Win %</span>
                    <span class="font-bold text-slate-900 dark:text-white">{{ "%.3f"|format(record.win_percentage) }}</span>
                </div>
                <div>
                    <span class="text-slate-500 dark:text-zinc-500 uppercase text-[10px] tracking-wider mr-2">Conf Rank</span>
                    <span class="font-bold text-slate-900 dark:text-white">#{{ record.conf_rank or '-' }}</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Main Content (Roster) -->
        <div class="lg:col-span-2 space-y-8">
            {% call card_container(title="Plantilla " ~ season) %}
                <div class="table-container">
                    <table class="min-w-full text-xs md:text-sm">
                        {{ stats_table_header([
                            {'label': 'Jugador', 'class': 'text-left'},
                            {'label': 'Pos'},
                            {'label': 'Altura'},
                            {'label': 'Peso'},
                            {'label': 'Exp'},
                            {'label': 'Escuela'}
                        ]) }}
                        <tbody class="divide-y divide-gray-100 dark:divide-white/5">
                            {% for player_season in roster %}
                            <tr class="hover:bg-gray-50 dark:hover:bg-white/5 transition cursor-pointer group" onclick="window.location='/players/{{ player_season.player.id }}'">
                                <td class="px-3 md:px-4 py-3 sticky-column bg-inherit">
                                    <div class="flex items-center gap-3">
                                        <div class="h-8 w-8 md:h-10 md:w-10 rounded-full bg-gray-100 dark:bg-zinc-800 flex-shrink-0 overflow-hidden border border-gray-200 dark:border-white/10 group-hover:border-orange-500/50 transition-colors">
                                            <img src="https://cdn.nba.com/headshots/nba/latest/260x190/{{ player_season.player.id }}.png" 
                                                 alt="" 
                                                 onerror="this.onerror=null; this.src='https://via.placeholder.com/50?text={{ player_season.player.full_name[:1] }}'"
                                                 class="h-[120%] w-[120%] object-cover object-top mt-1">
                                        </div>
                                        <div class="font-bold text-gray-900 dark:text-white group-hover:text-orange-500 transition-colors">{{ player_season.player.full_name }}</div>
                                    </div>
                                </td>
                                <td class="px-2 py-3 text-center text-zinc-500 dark:text-zinc-400 font-medium">{{ player_season.player.position or '-' }}</td>
                                <td class="px-2 py-3 text-center font-mono text-zinc-500 dark:text-zinc-400">{{ player_season.player.height or '-' }}</td>
                                <td class="px-2 py-3 text-center font-mono text-zinc-500 dark:text-zinc-400">{% if player_season.player.weight %}{{ player_season.player.weight }} lbs{% else %}-{% endif %}</td>
                                <td class="px-2 py-3 text-center font-mono text-zinc-500 dark:text-zinc-400">
                                    {{ player_season.player.experience }} 
                                    <span class="text-[10px] uppercase text-zinc-600">yrs</span>
                                </td>
                                <td class="px-2 py-3 text-zinc-500 dark:text-zinc-400 truncate max-w-[150px]">{{ player_season.player.school or '-' }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="6" class="py-12 text-center text-zinc-500 dark:text-zinc-400 font-medium">
                                    No hay información de plantilla disponible.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endcall %}
        </div>
        
        <!-- Sidebar (Recent Games) -->
        <div class="lg:col-span-1 space-y-6">
            {% call card_container(title="Últimos Partidos") %}
                <div class="space-y-2 p-3">
                    {% for game in recent_games %}
                    <div class="flex items-center justify-between p-3 bg-slate-50/50 dark:bg-white/5 rounded-lg hover:bg-slate-100 dark:hover:bg-white/10 transition cursor-pointer border border-transparent hover:border-slate-200 dark:hover:border-white/10 group" onclick="window.location='/games/{{ game.id }}'">
                        <div class="flex flex-col items-center min-w-[3rem]">
                            <span class="text-[10px] font-mono text-zinc-500 dark:text-zinc-400">{{ (game.date|string)[5:] }}</span>
                            {% set is_winner = (game.home_team_id == team.id and game.home_score > game.away_score) or (game.away_team_id == team.id and game.away_score > game.home_score) %}
                            <span class="inline-flex items-center justify-center w-6 h-6 mt-1 text-[10px] font-black {% if is_winner %}text-green-500 bg-green-500/10 border border-green-500/20{% else %}text-red-500 bg-red-500/10 border border-red-500/20{% endif %} rounded">
                                {{ 'W' if is_winner else 'L' }}
                            </span>
                        </div>
                        
                        <div class="flex-1 px-4 text-center">
                            <div class="flex items-center justify-center gap-2 text-sm text-slate-900 dark:text-white">
                                {% if game.home_team_id == team.id %}
                                    <span class="text-zinc-400 dark:text-zinc-600 text-xs font-bold">VS</span>
                                    <span class="font-display font-black text-lg">{{ game.away_team.abbreviation }}</span>
                                {% else %}
                                    <span class="text-zinc-400 dark:text-zinc-600 text-xs font-bold">@</span>
                                    <span class="font-display font-black text-lg">{{ game.home_team.abbreviation }}</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="text-right min-w-[3rem]">
                            <span class="text-sm font-mono font-bold text-slate-900 dark:text-white block group-hover:text-orange-500 transition-colors">
                                {% if game.home_team_id == team.id %}
                                    {{ game.home_score }}-{{ game.away_score }}
                                {% else %}
                                    {{ game.away_score }}-{{ game.home_score }}
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center text-zinc-500 py-8 text-sm">No hay partidos recientes.</div>
                    {% endfor %}
                </div>
            {% endcall %}
        </div>
    </div>
</div>
{% endblock %}

